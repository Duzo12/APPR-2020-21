---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
subtitle: "Analiza vod in odpada v Sloveniji"
author: "David Rozman"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Tema

Analiziral bom podatke, povezane s količino vode in odpada v Sloveniji v zadnjih letih.

Analiziral bom:
* Razmerje med načrpanimi površinskimi in podzemnimi vodami
* Količino načrpane vode
* Količino dobavljene vode
* Porazdelitev dobavljene vode po regijah
* Primerjavo količine odpada po regijah
* Primejavo količine odpada po občinah
* Napoved načrpane vode za prihodnja leta



***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Podatke sem uvozil v obliki CSV s spletne strani Statističnega urada Republike
Slovenije. Nato sem jih prečistil, odstranil nepotrebne stolpce, dodal nove (npr.
za izračun povprečji). Sledijo tabele z vsemi spremenljivkami.

Tabela o načrpani vodi:
* Leto
* Skupaj načrpana voda (deljeno z 10^5 za manjše številke)
* Načrpana podzemna voda
* Načrpana površinska voda


Tabela o dobavljeni vodi v m^3 na prebivalca:
* Leto
* Slovenija
* + vse slovenske regije

Tabela o odpadu:
* Leta 2002 - 2019
* Vse slovenske regije




***

# Analiza in vizualizacija podatkov

```{r vizualizacija, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Prvi graf prikazuje količino načrpane vode v Sloveniji v letih 2014-2019

```{r graf1, echo=FALSE, message=FALSE, fig.align='center'}
ggplot(tabela6, aes(x=LETO, y=NACRPANO.SKUPAJ, group=1)) + 
          geom_point(color="red", size=1) +
          geom_line() +
          ylab("Načrpana voda skupaj v 100.000 * m^3")
```

Na drugem grafu vidimo količino načrpane podzemne in površinske vode v letih
2013-2019

```{r dvojni stoplci, echo=FALSE, fig.align='center'}
  ggplot(zadvojnigraf, aes(fill=VRSTA.VODE, x=LETO, y=NACRPANO)) +
                geom_bar(position="dodge", stat="identity")

```

Tu vidimo povprečno razmerje med načrpano podmezno in površinsko vodo v letih 2013-2019

```{r graf2, echo=FALSE, fig.align='center'}
  graf2 <- ggplot(zapito, aes(x="", y=delez, fill=imeni2)) +
        geom_bar(width=1, stat="identity", color="white") +
        coord_polar("y", start=0) + 
        geom_text(aes(y=lab.ypos, label=delez), color="white") +
        theme_void() +
        labs(fill="Vrsta vode")

```

Naslednji graf prikazuje količino dobavljene vode na prebivalca v Sloveniji v letih
2003-2019

```{r graf3, echo=FALSE, fig.align='center'}
  ggplot(tabela2, aes(x=LETO, y=SLOVENIJA), group=1, asp=2) +
        geom_point(color="red") +
        geom_line(group=1) +
        xlab("Dobavljena voda v m^3 na prebivalca")
```


Sledeči tortni diagram prikazuje razmerje količin dobavljene vode v letu 2019
po slovenskih regijah

```{r graf4, echo=FALSE, fig.align='center'}
   ggplot(zapito2, aes(x="", y=delezi, fill=imena4)) +
        geom_bar(width=1, stat="identity", color="white") +
        coord_polar("y", start=0) + 
        geom_text(aes(y=lab.ypos, label=paste0(round(delezi, 2), "%"), x=1.3)) +
        theme_void() +
        labs(title="Porazdelitev dostavljene vode po regijah", fill="Regija")
```

Na naslednjem grafu vidimo koliko odpada letno je ustvaril povprečen prebivalec posamezne regije
v obdobju 2002-2019

```{r graf5, echo=FALSE, fig.align='center'}
  ggplot(odpadkiletnonaprebivalca, aes(x=povprecje, y=REGIJA)) + 
          geom_col(color="Brown", fill="Brown") +
          xlab("Povprečen letni odpad na prebivalca v kg") +
        ylab("Regija") + 
        labs("Povprečen letni odpad na prebivalca")
```

Sledi še zemljevid, ki prikazuje količino ustvarjenega odpada na enega prebivalca
občine v letu 2019.

```{r zemljevid1, echo=FALSE, fig.align='center'}
 tm_shape(merge(obcine, tabelazakartoobcine, by.x="OB_UIME", by.y="obcina")) +
                tm_polygons("odpadki19kgnaprebivalca")
```

***


# Napredna analiza podatkov

```{r analiza}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf napoveduje gibanje količine dobavljene vode v letih 2020-2025

```{r izrisnapovedi, echo=FALSE, fig.align='center'}
ggplot(napoved1, aes(x=LETO, y=SLOVENIJA)) +
  geom_point(shape=1) +
  geom_smooth(method=lm, formula=y~x) 
```

***

```{r shiny}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
