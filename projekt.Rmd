---
title: "Analiza razpoložljivega dohodka gospodinjstev v Sloveniji"
author: "Urban Rupnik"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

V svoji projektni nalogi bom analiziral razpoložljivi dohodek slovenskih gospodinjstev zadnjih let. Opazoval bom povprečni dohodek na člana gospodinjstva po opravljenih socialnih transferjih glede na vrsto dohodka, spol, starost in izobrazbo ter dohodek po statističnih regijah Slovenije.

<center>
![](slike/gradb-naslovna.jpg)

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Svoje podatke sem črpal s strani [SiStat](https://pxweb.stat.si/SiStat/sl) v obliki CSV datotek (ločeno s podpičjem, z glavo) ter v HTML obliki. Shranjeni so v istoimenski mapi [podatki](https://github.com/UrbanRupnik/APPR-2020-21/tree/master/podatki) in sicer kot štiri glavne razpredelnice v obliki *tidy data*, ki sem jih prečistil še v dve pod-razpredelnici za sledeče analize.

1. [Razpoložljivi dohodek gospodinjstev po starosti in spolu (EUR)](https://pxweb.stat.si:443/SiStatData/sq/1406)
  `starost_spol_vsi` 
  - `Starost` - spremenljivka: Starostne skupine (character),
  - `Spol` - spremenljivka: Spol osebe (character),
  - `Leto` - spremenljivka: Leto meritve dohodka (numeric),
  - `Dohodek` - meritev: Povprečni dohodek na člana gospodinjstva po opravljenih socialnih transferjih (numeric).
  
1.1.  `starost_spol` - razpredelnica brez skupne starostne skupine
  - `Starost` - spremenljivka: Starostne skupine (urejen faktor),
  - `Spol` - spremenljivka: Spol osebe (character),
  - `Leto` - spremenljivka: Leto meritve dohodka (numeric),
  - `Dohodek` - meritev: Povprečni dohodek na člana gospodinjstva po opravljenih socialnih transferjih (numeric).
  
1.2.   `spol` 
  - `Spol` - spremenljivka: Spol osebe (character),
  - `Leto` - spremenljivka: Leto meritve dohodka (numeric),
  - `Dohodek` - meritev: Povprečni dohodek na člana gospodinjstva po opravljenih socialnih transferjih (numeric).

2. [Razpoložljivi dohodek gospodinjstev glede na doseženo izobrazbo in spol (EUR)](https://pxweb.stat.si:443/SiStatData/sq/1407) 
  `izobrazba_spol`
  - `Izobrazba` - spremenljivka: Vrsta dosežene izobrazbe (urejen faktor),
  - `Spol` - spremenljivka: Spol osebe (character),
  - `Leto` - spremenljivka: Leto meritve dohodka (numeric),
  - `Dohodek` - meritev: Povprečni dohodek na člana gospodinjstva po opravljenih socialnih transferjih (numeric).
  
3. [Razpoložljivi dohodek gospodinjstev po statističnih regijah (EUR)](https://pxweb.stat.si:443/SiStatData/sq/1228)
  `regije`
  - `Regija` - spremenljivka: Ime statistične regije (character),
  - `Leto` - spremenljivka: Leto meritve dohodka (numeric),
  - `Dohodek` - meritev: Povprečni dohodek na člana gospodinjstva po opravljenih socialnih transferjih (numeric).
  
4. [Povprečni razpoložljivi dohodek gospodinjstev po vrstah dohodka (EUR)](https://pxweb.stat.si:443/SiStatData/sq/1214)
  `vrste_dohodka`
  - `Vrsta.dohodka` - spremenljivka: Vrsta dohodka (character),
  - `Leto` - spremenljivka: Leto meritve dohodka (integer),
  - `Dohodek` - meritev: Povprečni dohodek na člana gospodinjstva po opravljenih socialnih transferjih (integer).

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
tm_shape(merge(zemljevid, povprecja, by.x="OB_UIME", by.y="obcina")) +
  tm_polygons("povprecje", title="Povprečje") +
  tm_layout(title="Povprečno število otrok v družini")
```

***

# Napredna analiza podatkov

```{r analiza}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
